NODE endpoint
SQL >
    %
    SELECT 
        formatDateTime(toStartOfMinute(tool_call_timestamp), '%Y-%m-%dT%H:%M:%S') AS minute,
        count() AS total_tool_calls,
        uniq(execution_id) AS unique_executions,
        round(total_tool_calls / nullIf(unique_executions, 0), 2) AS avg_tools_per_execution
    FROM tool_calls
    WHERE user_id = {{ String(userId, 'user_001', description='User ID to filter by', required=True) }}
        AND tool_call_timestamp >= CASE 
            WHEN {{ String(timeframe, '24h', description='Timeframe: 1h, 24h, 7d, 30d', required=False) }} = '1h' THEN now64(3) - INTERVAL 1 HOUR
            WHEN {{ String(timeframe, '24h', description='Timeframe: 1h, 24h, 7d, 30d', required=False) }} = '24h' THEN now64(3) - INTERVAL 1 DAY
            WHEN {{ String(timeframe, '24h', description='Timeframe: 1h, 24h, 7d, 30d', required=False) }} = '7d' THEN now64(3) - INTERVAL 7 DAY
            WHEN {{ String(timeframe, '24h', description='Timeframe: 1h, 24h, 7d, 30d', required=False) }} = '30d' THEN now64(3) - INTERVAL 30 DAY
            ELSE now64(3) - INTERVAL 1 DAY
        END
    GROUP BY minute
    ORDER BY minute ASC
TYPE ENDPOINT


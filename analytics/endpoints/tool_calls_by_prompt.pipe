NODE endpoint
SQL >
    %
    SELECT 
        toStartOfMinute(tc.tool_call_timestamp) AS minute,
        pm.name AS prompt_name,
        count() AS tool_call_count
    FROM tool_calls tc
    JOIN prompt_metadata pm ON tc.prompt_id = pm.prompt_id
    WHERE tc.user_id = {{ String(userId, 'user_001', description='User ID to filter by', required=True) }}
        AND tc.tool_call_timestamp >= CASE 
            WHEN {{ String(timeframe, '24h', description='Timeframe: 1h, 24h, 7d, 30d', required=False) }} = '1h' THEN now() - INTERVAL 1 HOUR
            WHEN {{ String(timeframe, '24h', description='Timeframe: 1h, 24h, 7d, 30d', required=False) }} = '24h' THEN now() - INTERVAL 1 DAY
            WHEN {{ String(timeframe, '24h', description='Timeframe: 1h, 24h, 7d, 30d', required=False) }} = '7d' THEN now() - INTERVAL 7 DAY
            WHEN {{ String(timeframe, '24h', description='Timeframe: 1h, 24h, 7d, 30d', required=False) }} = '30d' THEN now() - INTERVAL 30 DAY
            ELSE now() - INTERVAL 1 DAY
        END
    GROUP BY minute, prompt_name
    ORDER BY minute DESC, tool_call_count DESC
TYPE ENDPOINT
